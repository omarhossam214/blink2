{%extends 'base/base.html' %}

{% load static %}

{% block content %}

<!doctype html>
<html lang="zxx">
<head>
    <meta charset="utf-8">
	<meta name="format-detection" content="telephone=no">
    <meta id="Viewport" name="viewport" content="initial-scale=1, maximum-scale=1, minimum-scale=1">
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}">
    <title>Fashionee - Checkout</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400&family=Raleway:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <meta name="it-rating" content="it-rat-cd303c3f80473535b3c667d0d67a7a11" />
    <meta name="cmsmagazine" content="3f86e43372e678604d35804a67860df7" />
    <style>
        .loaded .load-icon{display:block;}
        .loaded *{-webkit-transition:none; -ms-transition:none; transition:none;}
        .load-icon{width:100%; height:100%; margin:0; padding:0; display:none; z-index:99999; position:absolute; top:0; left:0; background:#fff;}
        .load-icon:before{content:""; width:64px; height:64px; margin:-32px 0 0 -32px; position:absolute; top:50%; left:50%; background:url(assets/img/loader.gif) no-repeat left top;}
    </style>     
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
    <script type="text/javascript">
        var user = '{{request.user}}';
    
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');
    </script>
              
</head>
        <!-- BEGIN MAIN -->
        <main class="main">              

            <!-- BEGIN INNER TOP -->
            <div class="inner-top">
                <div class="inner-top__main wrapper">
                    <div class="inner-top__cols">
                        <div class="inner-top__left">
                            <h1 class="inner-top__title">Checkout</h1>
                            <div class="breadcrumbs">
                                <ul class="breadcrumbs__list">
                                    <li class="breadcrumbs__item">
                                        <a class="breadcrumbs__link" href="#">Home</a>
                                    </li>
                                    <li class="breadcrumbs__item">Checkout</li>                                
                                </ul>
                            </div>
                        </div>
                        <div class="inner-top__right">
                            <div class="inner-top__image" data-bg="https://via.placeholder.com/800x400"></div>
                        </div>                        
                    </div>
                    <img class="inner-top__bg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" data-lazy="assets/img/svg/vector-inner-top.svg" alt="">
                </div>
            </div>
            <!-- INNER TOP END -->

            <!-- BEGIN CHECKOUT -->
            <div class="checkout-page wrapper">

                <div class="checkout-nav">
                    <div class="checkout-nav__item active">
                        <span class="checkout-nav__text">order details</span>
                    </div>
                    <div class="checkout-nav__item active current">
                        <span class="checkout-nav__text">payment method</span>
                    </div>
                    <div class="checkout-nav__item">
                        <span class="checkout-nav__text">finish</span>
                    </div>                                        
                </div>

                <div class="checkout-page__cols">

                    <!-- BEGIN LEFT COLUMN -->
                    <div class="checkout-page__left" >
                    
                            <section class="checkout-form">
                                <h2 class="checkout-form__title">payment method</h2>
                                    <h6> only the Cash payment is available at the moment </h6>
                                <div class="payment">
                                    <div class="payment__list">
                                        <div class="payment__radio radio">
                                            <label class="radio__label">
                                                <input class="radio__input" type="radio" name="payment" disabled>
                                                <span class="radio__icon"></span>
                                                <span class="radio__text">Visa/Mastercard</span>
                                            </label>
                                        </div>  
                                        <div class="payment__radio radio">
                                            <label class="radio__label">
                                                <input class="radio__input" name="payment" type="radio" disabled>
                                                <span class="radio__icon"></span>
                                                <span class="radio__text">Pay pal</span>
                                            </label>
                                        </div>  
                                        <div class="payment__radio radio">
                                            <label class="radio__label">
                                                <input class="radio__input" name="payment" type="radio" disabled>
                                                <span class="radio__icon"></span>
                                                <span class="radio__text">Payoneer</span>
                                            </label>
                                        </div>
                                        <div class="payment__radio radio">
                                            <label class="radio__label">
                                                <input class="radio__input" name="payment" type="radio" checked> 
                                                <span class="radio__icon"></span>
                                                <span class="radio__text">Cash</span>
                                            </label>
                                        </div>

                                    </div>
                                </div>
                                
                                <!--
                                <div class="card">
                                    <div class="card__left">
                                        <div class="card-form">
                                            <label class="card-form__label" for="card-number">Сard number</label>
                                            <input class="card-form__input text-input js-mask-card" id="card-number" type="text" placeholder="xxxx-xxxx-xxxx-xxxx">
                                            <label class="card-form__label" for="card-date">Expiration date</label>
                                            <div class="card-form__cols">
                                                <div class="card-form__col">
                                                    <input class="card-form__input text-input js-mask-date" id="card-date" type="text" placeholder="mm">                                                      
                                                </div>
                                                <div class="card-form__col">
                                                    <input class="card-form__input text-input js-mask-date" type="text" placeholder="yy">                                                      
                                                </div>                                                
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card__right">
                                        <div class="card-form">
                                            <div class="card-form__code">
                                                <label class="card-form__label card-form__label_grey" for="card-code">Secret code</label>
                                                <input class="card-form__cvv round-input js-mask-code" id="card-code" type="text" placeholder="cvv">  
                                            </div>                                            
                                        </div>
                                    </div>                                    
                                </div>
                                -->
                                <div class="checkout-form__buttons">
                                    <div class="checkout-form__button-col">
                                        <a class="checkout-form__back back-button" href="/checkout1">return</a>
                                    </div>
                                    <form id="test">
                                        <div class="checkout-form__button-col" >
                                            <button class="checkout-form__button button" type="submit">
                                                <span class="button__text" >confirm order</span>
                                            </button>
                                        </div>
                                    </form>
                                    <div>
                                        <h4 style="color:burlywood" id="outstock"> </h4>
                                    </div>                                   
                                </div>                                        
                            </section>
                            

                       
                    </div>
                    <!-- LEFT COLUMN END -->

                    <!-- BEGIN RIGHT COLUMN -->
                    <aside class="checkout-page__right">
                        
                        <section class="your-order">
                            <h3 class="your-order__title">Your order</h3>
                            <div class="side-cart">
                                {%for i in items%}
                                <article class="side-cart__item">
                                    <div class="side-cart__cols">
                                        <div class="side-cart__left">
                                            <a class="side-cart__image-link" href="{%url 'item:detail' i.product.id %}">
                                                <img class="side-cart__image" src="{{i.product.imageURL}}" alt="">
                                            </a>
                                        </div>
                                        <div class="side-cart__right">
                                            <h4 class="side-cart__title">
                                                <a class="side-cart__link" href="{%url 'item:detail' i.product.id %}">{{i.product.Name}} ({{i.selectedcolor}}) ({{i.selectedsize}})</a>
                                            </h4>
                                            <span class="side-cart__text">x {{i.quantity}}</span>
                                            <div class="side-cart__prices">
                                                <span class="side-cart__price">$ {{ i.product.price }}</span>
                                                <!--
                                                <span class="side-cart__old-price">$52.99</span>
                                                -->
                                            </div>
                                        </div>                                        
                                    </div>
                                </article>
                                {%endfor%}
                                <!--
                                <article class="side-cart__item">
                                    <div class="side-cart__cols">
                                        <div class="side-cart__left">
                                            <a class="side-cart__image-link" href="product_page.html">
                                                <img class="side-cart__image" src="https://via.placeholder.com/53x60" alt="">
                                            </a>
                                        </div>
                                        <div class="side-cart__right">
                                            <h4 class="side-cart__title">
                                                <a class="side-cart__link" href="product_page.html">Spray wrap skirt</a>
                                            </h4>
                                            <span class="side-cart__text">x1</span>
                                            <div class="side-cart__prices">
                                                <span class="side-cart__price">$110.99</span>
                                            </div>
                                        </div>                                        
                                    </div>
                                </article>
                                -->                                
                            </div>
                            <ul class="your-order__list">
                                <li class="your-order__item">
                                    <div class="your-order__col">
                                        <span class="your-order__text">Оrder price</span>
                                    </div>
                                    <div class="your-order__col">
                                        <span class="your-order__price"> {{order.get_cart_total}} EGP </span>
                                    </div>                                
                                </li>
                                <li class="your-order__item">
                                    <div class="your-order__col">
                                        <span class="your-order__text">Discount for promo&nbsp;code</span>
                                    </div>
                                    <div class="your-order__col">
                                        <span class="your-order__text promo-field" id="promo-value">{{order.promocode}}</span>
                                        {%if order.promocode != None%}
                                        <span class="your-order__text promo-field" id="promo-value" style="color:red; font-weight: bold;">- {{order.get_cart_discount}} EGP</span>
                                        {%endif%}
                                    </div>                                
                                </li>
                                <li class="your-order__item">
                                    
                                    <div class="your-order__col">
                                        <span class="your-order__text">Delivery&nbsp;&nbsp;<span></span></span>
                                    </div>
                                    <div class="your-order__col">
                                        <span class="your-order__fee" style="font-weight: bold;">{{order.d_fee}} EGP</span>
                                    </div>                                
                                </li>                                                        
                            </ul>
                            <div class="your-order__bottom">
                                <div class="your-order__col">
                                    <span class="your-order__bottom-text">Total</span>
                                </div>
                                <div class="your-order__col">
                                    <span class="your-order__bottom-price">{{order.total}} EGP</span>
                                </div>                            
                            </div>
                        </section>        
                                         
                    </aside>
                    <!-- RIGHT COLUMN END -->                    

                </div>              

            </div>
            <!-- CHECKOUT END -->           

        </main>
        <!-- MAIN END -->
        
        <!-- BEGIN FOOTER -->
        <footer class="footer">      
            <div class="footer__main wrapper">
                <div class="footer__top">
                    <div class="footer__cols">
                        <div class="footer__col">
                            <a class="footer-logo logo" href="#">
                                <img class="logo__image" src="https://via.placeholder.com/82x17" alt="">
                            </a>
                            <span class="footer-description">Cillum eu id enim aliquip aute ullamco anim. <br>Culpa deserunt nostrud excepteur voluptate.</span>  
                            <div class="footer-line"></div>  
                            <div class="socials">
                                <span class="socials__text">Find us here:</span>
                                <ul class="socials__list">
                                    <li class="socials__item">
                                        <a class="socials__link" href="#">Fb</a>
                                    </li>
                                    <li class="socials__item">
                                        <a class="socials__link" href="#">Tw</a>
                                    </li> 
                                    <li class="socials__item">
                                        <a class="socials__link" href="#">Ins</a>
                                    </li>
                                    <li class="socials__item">
                                        <a class="socials__link" href="#">Pt</a>
                                    </li>                                                                           
                                </ul>
                            </div>                        
                        </div>
                        <div class="footer__col">
                            <nav class="footer-nav">
                                <div class="footer-nav__col">
                                    <span class="footer-title">About</span>
                                    <ul class="footer-nav__list">
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="about.html">About us</a>
                                        </li>
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="collections.html">Collections</a>
                                        </li>
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="shop.html">Shop</a>
                                        </li>
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="blog.html">Blog</a>
                                        </li>
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="contacts.html">Contact us</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="footer-nav__col">
                                    <span class="footer-title">Useful links</span>
                                    <ul class="footer-nav__list">
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="#">Privacy Policy</a>
                                        </li>
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="#">Terms of use</a>
                                        </li>
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="#">Support</a>
                                        </li>
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="#">Shipping details</a>
                                        </li>
                                        <li class="footer-nav__item">
                                            <a class="footer-nav__link" href="faq">FAQs</a>
                                        </li>
                                    </ul>
                                </div>                                
                            </nav>
                        </div>
                        <div class="footer__col">
                            <span class="footer-title">Newsletter</span>
                            <span class="footer-description">Subscribe to be the first to hear about deals,&nbsp;&nbsp;offers and upcoming collections.</span>
                            
                                <div class="subscription">
                                    <input class="subscription__input" type="email" placeholder="Enter your email">
                                    <button class="subscription__button" type="submit"></button>
                                </div>
                                                       
                        </div>                                                
                    </div>
                </div>
                <div class="footer__bottom">
                    <div class="footer__cols">
                        <div class="footer__left">
                            <span class="copyrights">&copy; All right reserved. Mollee 2021</span>
                        </div>
                        <div class="footer__right">
                            <div class="payments">
                                <div class="payments__col">
                                    <span class="payments__text">Payment methods:</span>
                                </div>
                                <div class="payments__col">
                                    <ul class="payments__list">
                                        <li class="payments__item">
                                            <img class="payments__image" alt="" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" data-lazy="https://via.placeholder.com/34x20">
                                        </li>
                                        <li class="payments__item">
                                            <img class="payments__image" alt="" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" data-lazy="https://via.placeholder.com/34x20">
                                        </li>
                                        <li class="payments__item">
                                            <img class="payments__image" alt="" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" data-lazy="https://via.placeholder.com/34x20">
                                        </li>
                                        <li class="payments__item">
                                            <img class="payments__image" alt="" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" data-lazy="https://via.placeholder.com/34x20">
                                        </li>                                                                                  
                                    </ul>
                                </div>                                
                            </div>
                        </div>
                    </div>
                </div>
                <img class="footer__bg-left" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" data-lazy="assets/img/svg/vector-footer-left.svg" alt="">
                <img class="footer__bg-right" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=" data-lazy="assets/img/svg/vector-footer-right.svg" alt="">
            </div>
        </footer>
        <!-- FOOTER END -->    

    </div> 
       
    <script src="{% static 'js/libs/jquery-3.5.1.min.js' %}"></script> 
    <script src="{% static 'js/libs/jquery-migrate-1.4.1.min.js' %}"></script>   
    <script src="{% static 'js/components/inputmask.js' %}"></script> 
    <script src="{% static 'js/main.js' %}"></script>  

    <script type="text/javascript">

        var total = '{{order.get_cart_total}}'
        var form = document.getElementById('test')
        
        form.addEventListener('submit',function(e){
            e.preventDefault()
           

            console.log('payment')
            console.log(user)
            
            var userFormData = {
                "total":total,
                "submit":'submit'
            }

         


            var url = 'checkout2/submit_order'
            fetch(url,{
                method:"POST",
                headers:{
                    "Content-Type":'application/json',
                    'X-CSRFToken':csrftoken,
                },
                body:JSON.stringify({'form':userFormData})
            })
            .then((response) => response.json())
            .then((data) => {
            console.log(data);
            if (data.flow == 'out of stock') {
                console.log('You have to do something');
                var message = " *The following products are out of stock: <br>";
                for (var i = 0; i < data.product_out_stock.length; i++) {
                    var product = data.product_out_stock[i];
                    message += ` Product: ${product.product_id}, ( ${product.color} ),( ${product.size} ), reduce by : ${product.remaining_quantity} to complete your order <br>`;
                }
                document.getElementById('outstock').innerHTML = message;
            } else {
                window.location.href = '/checkout3';
            }
        });
    });
</script>


       
{% endblock content %}

</body>
</html>